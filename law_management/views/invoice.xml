<?xml version="1.0" encoding="utf-8"?>
<odoo>
   <!-- Form view of Trial Invoice -->
    <record id ="trial_invoice_form21" model="ir.ui.view">
        <field name="name">trial.invoice.form</field>
        <field name="model">account.move</field>
        <field name ="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type ="xml">
            <xpath expr="//field[@name='invoice_payment_term_id']" position ="after">
                <field name="pay_type" readonly="1"
                    attrs="{'invisible':[('move_type','!=','out_invoice')]}"/>
                <field name="trial_id"
                    attrs="{'invisible':['|',('move_type','!=','out_invoice'),
                    ('pay_type','!=','pay_per_trial'),
                    '|',('pay_type','!=','pay_per_fixed')]}" readonly="1"/>
            </xpath>
            <xpath expr="//div[hasclass('o_td_label')]" position="replace">
                <div class="o_td_label">
                                    <label for="partner_id" string="Client" style="font-weight:bold;" attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'out_receipt'))]}"/>
                                    <label for="partner_id" string="Vendor" style="font-weight:bold;" attrs="{'invisible': [('move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt'))]}"/>
                </div>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="string">Client</attribute>
                <attribute name="readonly">True</attribute>
            </xpath>
            <xpath expr="//field[@name='invoice_user_id']" position="after">
                <field name="matter_id" readonly="1"
                    attrs="{'invisible':[('move_type','!=','out_invoice')]}"/>
            </xpath>
            <xpath expr="//field[@name='invoice_user_id']" position="attributes">
                <attribute name="string">Lawyer</attribute>
                <attribute name="readonly">True</attribute>
            </xpath>

            <field name="discount" position="replace"/>
            <field name="product_id" position="replace"/>
            <field name="amount_untaxed" position="replace"/>
            <!-- <field name="amount_tax" position="replace"/> -->
            <xpath expr="//field[@name='price_unit']" position="attributes">
                <attribute name="string">Fees</attribute>
            </xpath>
            <xpath expr="//field[@name='quantity']" position="after">
                <field name="pay_type" readonly="1"/>
            </xpath>
           <xpath expr="//form/sheet/notebook/page/field[@name='invoice_line_ids']/tree/field[@name='quantity']" position="attributes">
                <attribute name="string">Working Hours</attribute>
                <attribute name="required">False</attribute>
                <attribute name="readonly">True</attribute>
                <attribute name="attrs">{'invisible':[('pay_type','!=','pay_per_hour')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='invoice_line_ids']" position="inside">
                <form>
                    <group cols="4">
                        <group>
                            <field name="name"/>
                            <field name="price_unit" string="Fees"/>
                        </group>
                        <group>
                            <field name="pay_type"/>
                            <field name="quantity" string="Working Hours"
                                attrs="{'invisible':[('pay_type','!=','pay_per_hour')]}"/>
                        </group>
                    </group>
                </form>
            </xpath>
            <xpath expr="//form/sheet/notebook/page/field[@name='invoice_line_ids']" position="attributes">
                <!-- <attribute name="readonly">True</attribute> -->
                <attribute name="options">{'no_delete':True}</attribute>
            </xpath>
            <xpath expr="//form/sheet/notebook/page/field[@name='invoice_line_ids']/tree/field[@name='name']" position="attributes">
                <attribute name="readonly">True</attribute>
            </xpath>
            <xpath expr="//field[@name='invoice_date_due']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//form/sheet/notebook/page[@name='other_info']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//field[@name='pay_type']" position="after">
                <field name="invoice_date_due"/>
            </xpath>
            <xpath expr="//form" position="attributes">
                <attribute name="create">false</attribute>
            </xpath>
            <xpath expr="//form/header/button[1]" position='attributes'>
                <attribute name="groups">
                    law_management.group_law_erp_admin,law_management.group_law_erp_lawyer
                </attribute>
           </xpath>
           <xpath expr="//form/header/button[2]" position='attributes'>
                <attribute name="groups">
                    law_management.group_law_erp_admin,law_management.group_law_erp_lawyer
                </attribute>
           </xpath>
           <xpath expr="//form/header/button[3]" position='attributes'>
                <attribute name="groups">
                    law_management.group_law_erp_admin,law_management.group_law_erp_lawyer
                </attribute>
           </xpath>
           <xpath expr="//form/header/button[4]" position='attributes'>
                <attribute name="groups">
                    law_management.group_law_erp_admin,law_management.group_law_erp_lawyer
                </attribute>
           </xpath>
        </field>
    </record>

    <!--  Tree view of the trial invoice-->
    <record id="trial_invoice_tree" model="ir.ui.view" >
        <field name="name">trial.move.tree</field>
        <field name="model">account.move</field>
        <field name ="inherit_id" ref="account.view_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='amount_total_signed']" position="before">
                <field name="trial_id"/>
                <field name="pay_type"/>
                <field name="payment_mode"/>
                <field name="matter_id"/>
            </xpath>
            <field name="partner_id" position="attributes">
                <attribute name="string">Client</attribute>
            </field>
            <xpath expr="//tree" position="attributes">
                <attribute name="create">false</attribute>
            </xpath>
        </field>
    </record>

    <!--  kanban view of the trial invoice-->
    <record id="trial_invoice_kanban" model="ir.ui.view" >
        <field name="name">trial.move.kanban</field>
        <field name="model">account.move</field>
        <field name ="inherit_id" ref="account.view_account_move_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="create">false</attribute>
            </xpath>
        </field>
    </record>

    <!-- Inherited Form view of the trial invoice lines-->
    <record id="trial_invoice_line_tree" model="ir.ui.view" >
        <field name="name">trial.account.move.line.tree</field>
        <field name="model">account.move.line</field>
        <field name ="inherit_id" ref="account.view_move_line_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field name="pay_type" readonly="1"/>
            </xpath>
        </field>
    </record>

    <!-- Action for Matter Invoice -->
    <record id="law_management.matter_invoice" model="ir.actions.act_window">
        <field name="name">Matter Invoices</field>
        <field name="res_model">account.move</field>
        <field name="binding_model_id" ref="law_management.model_matter_matter"/>
        <field name="view_mode">tree,kanban,form,pivot,graph</field>
        <field name="domain">[('matter_id','=',active_id),('move_type','=','out_invoice')]</field>
        <field name="context">{'form_view_ref': 'account.invoice_form',
                    'tree_view_ref': 'account.invoice_tree',
                    'search_default_matter_id': [active_id],
                    'default_matter_id': active_id,
                    
                }
        </field>
        <field name="search_view_id" ref="account.view_account_invoice_filter"/>
         <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to create a customer invoice.
          </p><p>
            Odoo's electronic invoicing allows to ease and fasten the
            collection of customer payments. Your customer receives the
            invoice by email and he can pay online and/or import it
            in his own system.
          </p><p>
            The discussions with your customer are automatically displayed at
            the bottom of each invoice.
          </p>
        </field>
    </record>
</odoo>
